"use strict";(self["webpackChunkdaijia_admin"]=self["webpackChunkdaijia_admin"]||[]).push([[684],{425:(e,a,l)=>{l.d(a,{Aj:()=>r,NV:()=>n,Ut:()=>o,V6:()=>u,xh:()=>d});var t=l(5720);function o(e){const a={pageSize:e?.pageSize||10,pageNum:e?.pageNum||1,...e};return(0,t.A)({url:"/sysDept/list",method:"get",params:a})}function r(e){return(0,t.A)({url:"/sysDept/getById",method:"get",params:{id:e}})}function d(e){return(0,t.A)({url:"/sysDept/add",method:"post",data:e})}function n(e){return(0,t.A)({url:"/sysDept/update",method:"post",data:e})}function u(e){return(0,t.A)({url:"/sysDept/delete",method:"post",params:{id:e}})}},2684:(e,a,l)=>{l.r(a),l.d(a,{default:()=>b});var t=l(6768),o=l(4232),r=l(144),d=l(1219),n=l(2933),u=l(2549),s=l(425),p=l(7780);const i={class:"app-container"},m={class:"dialog-footer"},c={__name:"SysUser",setup(e){const a=(0,r.Kh)({pageNum:1,pageSize:10,username:void 0,name:void 0,phone:void 0,deptId:void 0,postId:void 0,status:void 0,deptName:void 0,postName:void 0}),l=(0,r.KR)([]),c=(0,r.KR)(!1),g=(0,r.KR)(0),v=(0,r.KR)([]),b=(0,r.KR)([]),h=(0,r.KR)(!1),f=(0,r.KR)(null),k=(0,r.Kh)({id:"",username:"",name:"",phone:"",deptId:void 0,postId:void 0,status:1,description:""}),y=(0,r.KR)(!1),F=(0,r.KR)([]),w=(0,r.KR)(0),_=(0,r.KR)(!1),N=(0,r.Kh)({pageNum:1,pageSize:10,username:"",minAccessTime:void 0,maxAccessTime:void 0}),V=(0,r.KR)(!1),z=(0,r.KR)([]),I=(0,r.KR)(0),C=(0,r.KR)(!1),S=(0,r.Kh)({pageNum:1,pageSize:10,operName:"",deptName:"",status:void 0,operatorType:void 0,businessType:void 0,requestMethod:void 0,minOperTime:void 0,maxOperTime:void 0}),A={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},K=async()=>{try{c.value=!0;const e=await(0,u.CF)(a);console.log("用户列表响应:",e);const t=e.data.items||[];l.value=t.map((e=>{const a={...e};if(!a.deptName&&a.deptId&&v.value.length>0){const e=v.value.find((e=>e.id==a.deptId));e&&(a.deptName=e.name)}if(!a.postName&&a.postId&&b.value.length>0){const e=b.value.find((e=>e.id==a.postId));e&&(a.postName=e.name)}return a})),g.value=e.data.total||0,0!==v.value.length&&0!==b.value.length||(await Promise.all([R(),E()]),l.value=l.value.map((e=>{const a={...e};if(!a.deptName&&a.deptId){const e=v.value.find((e=>e.id==a.deptId));e&&(a.deptName=e.name)}if(!a.postName&&a.postId){const e=b.value.find((e=>e.id==a.postId));e&&(a.postName=e.name)}return a})))}catch(e){console.error("获取用户列表失败",e),d.nk.error("获取用户列表失败: "+(e.message||"未知错误"))}finally{c.value=!1}},U=()=>{a.pageNum=1,K()},W=()=>{a.username=void 0,a.name=void 0,a.phone=void 0,a.deptName=void 0,a.pageNum=1,K()},x=async e=>{try{if(console.log("开始编辑用户:",e),e.id){const a=await(0,u.kl)(e.id);console.log("获取用户详细信息:",a),a?(k.id=a.id||e.id,k.username=a.username||e.username,k.name=a.name||e.name,k.phone=a.phone||e.phone,k.deptId=a.deptId||e.deptId,k.postId=a.postId||e.postId,k.status=void 0!==a.status?a.status:e.status||1,k.description=a.description||e.description||"",k.password=a.password||"",k.headUrl=a.headUrl||""):Object.keys(k).forEach((a=>{void 0!==e[a]&&(k[a]=e[a])}))}else Object.keys(k).forEach((a=>{void 0!==e[a]&&(k[a]=e[a])}));h.value=!0;try{await Promise.all([R(),E()])}catch(a){console.error("获取选项数据失败",a)}}catch(a){console.error("编辑用户时出错:",a),d.nk.error("打开编辑对话框失败: "+(a.message||"未知错误"))}},T=e=>{n.s.confirm(`确定要删除用户 ${e.username} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await(0,u.hG)(e.id),d.nk.success("删除成功"),K()}catch(a){d.nk.error("删除失败")}})).catch((()=>{}))},R=async()=>{try{const e=await(0,s.Ut)();console.log("获取部门选项响应:",e),e.data&&e.data.items?v.value=X(P(e.data.items)):e.data&&Array.isArray(e.data)?v.value=X(e.data):(console.warn("未识别的部门数据格式"),v.value=[])}catch(e){console.error("获取部门选项失败",e),d.nk.warning("获取部门选项失败，请稍后再试"),v.value=[]}},P=e=>{const a={};e.forEach((e=>{e.children=[],a[e.id]=e}));const l=[];return e.forEach((e=>{e.parentId&&a[e.parentId]?a[e.parentId].children.push(e):l.push(e)})),l},X=e=>{if(!e||!Array.isArray(e))return console.warn("部门树结构无效",e),[];const a=[],l=e=>{e.forEach((e=>{e&&e.id&&(a.push({id:e.id,name:e.name}),e.children&&e.children.length>0&&l(e.children))}))};return l(e),a},E=async()=>{try{const e={pageSize:100,pageNum:1},a=await(0,p.F4)(e);console.log("获取岗位选项响应:",a),a.data&&a.data.items?b.value=(a.data.items||[]).map((e=>({id:e.id,name:e.name}))):a.data&&Array.isArray(a.data)?b.value=a.data.map((e=>({id:e.id,name:e.name}))):(console.warn("未识别的岗位数据格式"),b.value=[])}catch(e){console.error("获取岗位选项失败",e),d.nk.warning("获取岗位选项失败，请稍后再试"),b.value=[]}},j=()=>{f.value.validate((async e=>{if(e)try{console.log("提交前的用户表单数据:",k);const e=await(0,u.TK)(k);if(console.log("更新用户返回结果:",e),!0!==e)throw new Error("服务器返回失败状态");d.nk.success("更新成功"),h.value=!1,K()}catch(a){console.error("更新用户失败:",a),d.nk.error("更新失败: "+(a.message||"未知错误"))}}))},D=e=>{a.pageSize=e,K()},q=e=>{a.pageNum=e,K()},$=async e=>{try{F.value=[],w.value=0,y.value=!0,_.value=!0,N.username=e.username,N.pageNum=1,N.pageSize=10,console.log("准备查询用户登录日志:",e.username),setTimeout((async()=>{try{await B()}catch(e){console.error("加载登录日志失败:",e),d.nk.error("加载日志数据出错")}finally{_.value=!1}}),100)}catch(a){console.error("显示登录日志对话框失败:",a),d.nk.error("无法加载登录日志"),y.value=!1,_.value=!1}},B=async()=>{try{console.log("发送登录日志查询参数:",N);const e={pageNum:N.pageNum,pageSize:N.pageSize,username:N.username},a=await(0,u.vx)(e);if(console.log("登录日志响应:",a),a&&a.data){const e=Array.isArray(a.data.items)?a.data.items:[];e.length>0&&(console.log("日志详细结构示例:",e[0]),console.log("所有日志状态值:"),e.forEach(((e,a)=>{console.log(`日志 ${a+1} - status: ${e.status}, msg: ${e.msg}`)}))),F.value=e,w.value=a.data.total||0,0===F.value.length&&d.nk.info("该用户没有登录日志记录")}else F.value=[],w.value=0,d.nk.info("未获取到日志数据")}catch(e){console.error("获取登录日志失败",e),d.nk.error("获取登录日志出错: "+(e.message||"未知错误")),F.value=[],w.value=0}},O=e=>{N.pageSize=e,_.value=!0,B().finally((()=>{_.value=!1}))},L=e=>{N.pageNum=e,_.value=!0,B().finally((()=>{_.value=!1}))},Q=async e=>{try{z.value=[],I.value=0,V.value=!0,C.value=!0,S.operName=e.username,S.pageNum=1,S.pageSize=10,console.log("准备查询用户操作日志:",e.username),setTimeout((async()=>{try{await M()}catch(e){console.error("加载操作日志失败:",e),d.nk.error("加载日志数据出错")}finally{C.value=!1}}),100)}catch(a){console.error("显示操作日志对话框失败:",a),d.nk.error("无法加载操作日志"),V.value=!1,C.value=!1}},M=async()=>{try{console.log("发送操作日志查询参数:",S);const e={pageNum:S.pageNum,pageSize:S.pageSize,operName:S.operName},a=await(0,u.S3)(e);if(console.log("操作日志响应:",a),a&&a.data){const e=Array.isArray(a.data.items)?a.data.items:[];z.value=e,I.value=a.data.total||0,0===z.value.length&&d.nk.info("该用户没有操作日志记录")}else z.value=[],I.value=0,d.nk.info("未获取到日志数据")}catch(e){console.error("获取操作日志失败",e),d.nk.error("获取操作日志出错: "+(e.message||"未知错误")),z.value=[],I.value=0}},G=e=>{S.pageSize=e,C.value=!0,M().finally((()=>{C.value=!1}))},H=e=>{S.pageNum=e,C.value=!0,M().finally((()=>{C.value=!1}))};return(0,t.sV)((async()=>{try{await Promise.all([R(),E()]),await K()}catch(e){console.error("页面初始化失败:",e),d.nk.error("加载数据失败，请刷新页面重试")}})),(e,r)=>{const d=(0,t.g2)("el-input"),n=(0,t.g2)("el-form-item"),u=(0,t.g2)("el-button"),s=(0,t.g2)("el-form"),p=(0,t.g2)("el-card"),K=(0,t.g2)("el-table-column"),R=(0,t.g2)("el-tag"),P=(0,t.g2)("el-table"),X=(0,t.g2)("el-pagination"),E=(0,t.g2)("el-option"),B=(0,t.g2)("el-select"),M=(0,t.g2)("el-radio"),Y=(0,t.g2)("el-radio-group"),J=(0,t.g2)("el-dialog"),Z=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(p,{class:"search-card"},{default:(0,t.k6)((()=>[(0,t.bF)(s,{model:a,ref:"queryForm",inline:!0,class:"search-form"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"用户名",prop:"username"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:a.username,"onUpdate:modelValue":r[0]||(r[0]=e=>a.username=e),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"姓名",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:a.name,"onUpdate:modelValue":r[1]||(r[1]=e=>a.name=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"手机号",prop:"phone"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:a.phone,"onUpdate:modelValue":r[2]||(r[2]=e=>a.phone=e),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"部门",prop:"deptName"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:a.deptName,"onUpdate:modelValue":r[3]||(r[3]=e=>a.deptName=e),placeholder:"请输入部门",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,null,{default:(0,t.k6)((()=>[(0,t.bF)(u,{type:"primary",onClick:U},{default:(0,t.k6)((()=>r[17]||(r[17]=[(0,t.eW)("查询")]))),_:1}),(0,t.bF)(u,{onClick:W},{default:(0,t.k6)((()=>r[18]||(r[18]=[(0,t.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,t.bF)(p,null,{header:(0,t.k6)((()=>r[19]||(r[19]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"用户列表")],-1)]))),default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(P,{data:l.value,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(K,{type:"index",label:"#",width:"50"}),(0,t.bF)(K,{prop:"username",label:"用户名"}),(0,t.bF)(K,{prop:"name",label:"姓名"}),(0,t.bF)(K,{prop:"phone",label:"手机号"}),(0,t.bF)(K,{prop:"deptName",label:"部门"}),(0,t.bF)(K,{prop:"postName",label:"岗位"}),(0,t.bF)(K,{prop:"status",label:"状态"},{default:(0,t.k6)((e=>[(0,t.bF)(R,{type:1===e.row.status?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(1===e.row.status?"正常":"停用"),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(K,{label:"操作",width:"350"},{default:(0,t.k6)((e=>[(0,t.bF)(u,{type:"primary",link:"",onClick:a=>x(e.row)},{default:(0,t.k6)((()=>r[20]||(r[20]=[(0,t.eW)("编辑")]))),_:2},1032,["onClick"]),(0,t.bF)(u,{type:"danger",link:"",onClick:a=>T(e.row)},{default:(0,t.k6)((()=>r[21]||(r[21]=[(0,t.eW)("删除")]))),_:2},1032,["onClick"]),(0,t.bF)(u,{type:"info",link:"",onClick:a=>$(e.row)},{default:(0,t.k6)((()=>r[22]||(r[22]=[(0,t.eW)("登录日志")]))),_:2},1032,["onClick"]),(0,t.bF)(u,{type:"warning",link:"",onClick:a=>Q(e.row)},{default:(0,t.k6)((()=>r[23]||(r[23]=[(0,t.eW)("操作日志")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Z,c.value]]),g.value>0?((0,t.uX)(),(0,t.Wv)(X,{key:0,"current-page":a.pageNum,"onUpdate:currentPage":r[4]||(r[4]=e=>a.pageNum=e),"page-size":a.pageSize,"onUpdate:pageSize":r[5]||(r[5]=e=>a.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:g.value,onSizeChange:D,onCurrentChange:q},null,8,["current-page","page-size","total"])):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(J,{title:"编辑用户",modelValue:h.value,"onUpdate:modelValue":r[14]||(r[14]=e=>h.value=e),width:"500px"},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",m,[(0,t.bF)(u,{onClick:r[13]||(r[13]=e=>h.value=!1)},{default:(0,t.k6)((()=>r[26]||(r[26]=[(0,t.eW)("取消")]))),_:1}),(0,t.bF)(u,{type:"primary",onClick:j},{default:(0,t.k6)((()=>r[27]||(r[27]=[(0,t.eW)("确定")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)(s,{ref_key:"userFormRef",ref:f,model:k,rules:A,"label-width":"80px"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"用户名",prop:"username"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:k.username,"onUpdate:modelValue":r[6]||(r[6]=e=>k.username=e),placeholder:"请输入用户名",disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"姓名",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:k.name,"onUpdate:modelValue":r[7]||(r[7]=e=>k.name=e),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"手机号",prop:"phone"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:k.phone,"onUpdate:modelValue":r[8]||(r[8]=e=>k.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"部门",prop:"deptId"},{default:(0,t.k6)((()=>[(0,t.bF)(B,{modelValue:k.deptId,"onUpdate:modelValue":r[9]||(r[9]=e=>k.deptId=e),placeholder:"请选择部门"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(v.value,(e=>((0,t.uX)(),(0,t.Wv)(E,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"岗位",prop:"postId"},{default:(0,t.k6)((()=>[(0,t.bF)(B,{modelValue:k.postId,"onUpdate:modelValue":r[10]||(r[10]=e=>k.postId=e),placeholder:"请选择岗位"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(b.value,(e=>((0,t.uX)(),(0,t.Wv)(E,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"状态",prop:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(Y,{modelValue:k.status,"onUpdate:modelValue":r[11]||(r[11]=e=>k.status=e)},{default:(0,t.k6)((()=>[(0,t.bF)(M,{label:1},{default:(0,t.k6)((()=>r[24]||(r[24]=[(0,t.eW)("正常")]))),_:1}),(0,t.bF)(M,{label:0},{default:(0,t.k6)((()=>r[25]||(r[25]=[(0,t.eW)("禁用")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"描述",prop:"description"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:k.description,"onUpdate:modelValue":r[12]||(r[12]=e=>k.description=e),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,t.bF)(J,{title:"用户登录日志",modelValue:y.value,"onUpdate:modelValue":r[15]||(r[15]=e=>y.value=e),width:"800px"},{default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(P,{data:F.value,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(K,{type:"index",label:"#",width:"50"}),(0,t.bF)(K,{prop:"username",label:"用户名",width:"120"}),(0,t.bF)(K,{prop:"ipaddr",label:"IP地址",width:"150"}),(0,t.bF)(K,{prop:"status",label:"状态",width:"80"},{default:(0,t.k6)((e=>[(0,t.bF)(R,{type:e.row.msg&&e.row.msg.includes("成功")?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.row.msg&&e.row.msg.includes("成功")?"成功":"失败"),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(K,{prop:"msg",label:"消息"}),(0,t.bF)(K,{prop:"accessTime",label:"访问时间",width:"180"})])),_:1},8,["data"])),[[Z,_.value]]),w.value>0?((0,t.uX)(),(0,t.Wv)(X,{key:0,"current-page":N.pageNum,"page-size":N.pageSize,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:w.value,onSizeChange:O,onCurrentChange:L,class:"pagination"},null,8,["current-page","page-size","total"])):(0,t.Q3)("",!0)])),_:1},8,["modelValue"]),(0,t.bF)(J,{title:"用户操作日志",modelValue:V.value,"onUpdate:modelValue":r[16]||(r[16]=e=>V.value=e),width:"900px"},{default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(P,{data:z.value,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(K,{type:"index",label:"#",width:"50"}),(0,t.bF)(K,{prop:"operName",label:"操作人",width:"120"}),(0,t.bF)(K,{prop:"deptName",label:"部门",width:"120"}),(0,t.bF)(K,{prop:"businessType",label:"业务类型",width:"100"}),(0,t.bF)(K,{prop:"operatorType",label:"操作类型",width:"100"}),(0,t.bF)(K,{prop:"method",label:"请求方法",width:"120"}),(0,t.bF)(K,{prop:"requestMethod",label:"HTTP方法",width:"100"}),(0,t.bF)(K,{prop:"status",label:"状态",width:"80"},{default:(0,t.k6)((e=>[(0,t.bF)(R,{type:0===e.row.status||e.row.msg&&e.row.msg.includes("成功")?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(0===e.row.status||e.row.msg&&e.row.msg.includes("成功")?"成功":"失败"),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(K,{prop:"operTime",label:"操作时间",width:"180"})])),_:1},8,["data"])),[[Z,C.value]]),I.value>0?((0,t.uX)(),(0,t.Wv)(X,{key:0,"current-page":S.pageNum,"page-size":S.pageSize,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:I.value,onSizeChange:G,onCurrentChange:H,class:"pagination"},null,8,["current-page","page-size","total"])):(0,t.Q3)("",!0)])),_:1},8,["modelValue"])])}}};var g=l(1241);const v=(0,g.A)(c,[["__scopeId","data-v-ba74bdf2"]]),b=v},7780:(e,a,l)=>{l.d(a,{F4:()=>o,SD:()=>d,gg:()=>n,tY:()=>r,ys:()=>u});var t=l(5720);function o(e){return(0,t.A)({url:"/sysPost/list",method:"get",params:e})}function r(e){return(0,t.A)({url:"/sysPost/getById",method:"get",params:{id:e}})}function d(e){return(0,t.A)({url:"/sysPost/add",method:"post",data:e})}function n(e){return(0,t.A)({url:"/sysPost/update",method:"post",data:e})}function u(e){return(0,t.A)({url:"/sysPost/delete",method:"post",params:{id:e}})}}}]);
//# sourceMappingURL=684.5a5ee8d9.js.map