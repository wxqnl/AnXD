"use strict";(self["webpackChunkdaijia_admin"]=self["webpackChunkdaijia_admin"]||[]).push([[829],{4180:(e,t,a)=>{a.d(t,{$e:()=>n,Au:()=>s,WB:()=>p,aH:()=>u,iY:()=>l,n7:()=>o,vv:()=>d});var r=a(5720);function o(e){return(0,r.A)({url:"/order/getOrderInfo",method:"post",params:e})}function n(e){return(0,r.A)({url:"/order/getByOrderNo",method:"post",params:{orderNo:e}})}function l(e){return(0,r.A)({url:"/order/update",method:"post",data:e})}function s(e){return(0,r.A)({url:"/orderComment/list",method:"post",params:e})}function u(e){return(0,r.A)({url:"/orderComment/getByOrderId",method:"get",params:{orderId:e}})}function d(e){return(0,r.A)({url:"/orderComment/update",method:"post",data:e})}function p(e){return(0,r.A)({url:"/feedback/getFeed",method:"get",params:{orderId:e}})}},9829:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var r=a(6768),o=a(4232),n=a(144),l=a(2933),s=a(1219),u=a(4180);const d={class:"app-container"},p={key:0},c={key:1},i={key:2},m={__name:"OrderInfo",setup(e){const t=(0,n.Kh)({pageNum:1,pageSize:10,orderNo:"",customerName:"",driverName:"",status:void 0}),a=(0,n.KR)([]),m=(0,n.KR)(!1),g=(0,n.KR)(0),b=async()=>{try{m.value=!0;const e=await(0,u.n7)(t);console.log("订单列表响应:",e),a.value=e.data.items||[],g.value=e.data.total||0}catch(e){console.error("获取订单列表失败",e)}finally{m.value=!1}},k=()=>{t.pageNum=1,b()},f=()=>{t.orderNo="",t.customerName="",t.driverName="",t.status=void 0,t.pageNum=1,b()},v=e=>{const t={1:"等待接单",2:"已接单",3:"司机已到达",4:"开始代驾",5:"结束代驾",6:"未付款",7:"已付款",8:"订单已结束",9:"顾客撤单",10:"司机撤单",11:"事故关闭",12:"其他"};return t[e]||"未知"},h=e=>{const t={1:"info",2:"warning",3:"warning",4:"primary",5:"primary",6:"danger",7:"success",8:"success",9:"danger",10:"danger",11:"danger",12:"info"};return t[e]||""},F=async e=>{try{m.value=!0;const t=await(0,u.$e)(e.orderNo);if(t.data){const e=t.data;l.s.alert(`<div class="order-detail">\n          <p><strong>订单号：</strong>${e.orderNo||"暂无"}</p>\n          <p><strong>客户ID：</strong>${e.customerId||"暂无"}</p>\n          <p><strong>司机ID：</strong>${e.driverId||"暂无"}</p>\n          <p><strong>起始地点：</strong>${e.startLocation||"暂无"}</p>\n          <p><strong>结束地点：</strong>${e.endLocation||"暂无"}</p>\n          <p><strong>预估金额：</strong>${e.expectAmount?"¥"+e.expectAmount:"暂无"}</p>\n          <p><strong>实际金额：</strong>${e.realAmount?"¥"+e.realAmount:"暂无"}</p>\n          <p><strong>预估里程：</strong>${e.expectDistance?e.expectDistance+"km":"暂无"}</p>\n          <p><strong>实际里程：</strong>${e.realDistance?e.realDistance+"km":"暂无"}</p>\n          <p><strong>订单状态：</strong>${v(e.status)||"暂无"}</p>\n          <p><strong>接单时间：</strong>${e.acceptTime||"暂无"}</p>\n          <p><strong>开始时间：</strong>${e.startServiceTime||"暂无"}</p>\n          <p><strong>结束时间：</strong>${e.endServiceTime||"暂无"}</p>\n          <p><strong>支付时间：</strong>${e.payTime||"暂无"}</p>\n          <p><strong>车牌号：</strong>${e.carLicense||"暂无"}</p>\n          <p><strong>车型：</strong>${e.carType||"暂无"}</p>\n          <p><strong>备注：</strong>${e.remark||"暂无"}</p>\n        </div>`,"订单详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定"})}else s.nk.warning("未找到该订单详情")}catch(t){console.error("获取订单详情失败",t),s.nk.error("获取订单详情失败")}finally{m.value=!1}},y=e=>{const t=(0,n.KR)(1===e.status?2:2===e.status?3:3===e.status?4:5);l.s.prompt("请输入新的订单状态 (1=待接单, 2=已接单, 3=进行中, 4=已完成, 5=已取消)","修改订单状态",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.value,inputValidator:e=>{const t=parseInt(e);return t>=1&&t<=5||"请输入1-5之间的数字"}}).then((({value:t})=>{const a=parseInt(t);(0,u.iY)({...e,status:a}).then((()=>{s.nk.success("状态修改成功"),b()})).catch((e=>{s.nk.error("状态修改失败")}))})).catch((()=>{}))},N=async e=>{try{const t=await(0,u.$e)(e.orderNo);if(!t.data)return void s.nk.error("无法获取订单详情");const a=t.data.id||t.data.orderId||t.data.customerId;if(!a)return void s.nk.error("无法获取有效的订单ID");console.log("使用订单ID查询反馈:",a);const r=await(0,u.WB)(a);r.data?l.s.alert(r.data,"订单反馈",{confirmButtonText:"确定"}):s.nk.info("该订单暂无反馈信息")}catch(t){console.error("获取订单反馈失败",t),s.nk.error("获取订单反馈失败: "+(t.message||"未知错误"))}},_=e=>{t.pageSize=e,b()},w=e=>{t.pageNum=e,b()};return(0,r.sV)((()=>{b()})),(e,n)=>{const l=(0,r.g2)("el-input"),s=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-option"),b=(0,r.g2)("el-select"),C=(0,r.g2)("el-button"),$=(0,r.g2)("el-form"),A=(0,r.g2)("el-card"),I=(0,r.g2)("el-table-column"),V=(0,r.g2)("el-tag"),x=(0,r.g2)("el-table"),W=(0,r.g2)("el-pagination"),T=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(A,{class:"search-card"},{default:(0,r.k6)((()=>[(0,r.bF)($,{model:t,ref:"queryForm",inline:!0,class:"search-form"},{default:(0,r.k6)((()=>[(0,r.bF)(s,{label:"订单号",prop:"orderNo"},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:t.orderNo,"onUpdate:modelValue":n[0]||(n[0]=e=>t.orderNo=e),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])])),_:1}),(0,r.bF)(s,{label:"客户姓名",prop:"customerName"},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:t.customerName,"onUpdate:modelValue":n[1]||(n[1]=e=>t.customerName=e),placeholder:"请输入客户姓名",clearable:""},null,8,["modelValue"])])),_:1}),(0,r.bF)(s,{label:"司机姓名",prop:"driverName"},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:t.driverName,"onUpdate:modelValue":n[2]||(n[2]=e=>t.driverName=e),placeholder:"请输入司机姓名",clearable:""},null,8,["modelValue"])])),_:1}),(0,r.bF)(s,{label:"订单状态",prop:"status"},{default:(0,r.k6)((()=>[(0,r.bF)(b,{modelValue:t.status,"onUpdate:modelValue":n[3]||(n[3]=e=>t.status=e),placeholder:"请选择订单状态",clearable:""},{default:(0,r.k6)((()=>[(0,r.bF)(u,{label:"待接单",value:1}),(0,r.bF)(u,{label:"已接单",value:2}),(0,r.bF)(u,{label:"进行中",value:3}),(0,r.bF)(u,{label:"已完成",value:4}),(0,r.bF)(u,{label:"已取消",value:5})])),_:1},8,["modelValue"])])),_:1}),(0,r.bF)(s,null,{default:(0,r.k6)((()=>[(0,r.bF)(C,{type:"primary",onClick:k},{default:(0,r.k6)((()=>n[6]||(n[6]=[(0,r.eW)("查询")]))),_:1}),(0,r.bF)(C,{onClick:f},{default:(0,r.k6)((()=>n[7]||(n[7]=[(0,r.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,r.bF)(A,null,{header:(0,r.k6)((()=>n[8]||(n[8]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"订单列表")],-1)]))),default:(0,r.k6)((()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(x,{data:a.value,border:""},{default:(0,r.k6)((()=>[(0,r.bF)(I,{type:"index",label:"#",width:"50"}),(0,r.bF)(I,{prop:"orderNo",label:"订单号",width:"180"}),(0,r.bF)(I,{prop:"customerName",label:"客户名称"}),(0,r.bF)(I,{prop:"driverName",label:"司机名称"}),(0,r.bF)(I,{prop:"startLocation",label:"起始地点","show-overflow-tooltip":""}),(0,r.bF)(I,{prop:"endLocation",label:"结束地点","show-overflow-tooltip":""}),(0,r.bF)(I,{label:"订单金额"},{default:(0,r.k6)((e=>[e.row.realAmount?((0,r.uX)(),(0,r.CE)("span",p,"¥"+(0,o.v_)(e.row.realAmount),1)):e.row.expectAmount?((0,r.uX)(),(0,r.CE)("span",c,"¥"+(0,o.v_)(e.row.expectAmount)+" (预估)",1)):((0,r.uX)(),(0,r.CE)("span",i,"-"))])),_:1}),(0,r.bF)(I,{label:"接单时间",width:"160"},{default:(0,r.k6)((e=>[(0,r.eW)((0,o.v_)(e.row.acceptTime||"-"),1)])),_:1}),(0,r.bF)(I,{prop:"status",label:"订单状态"},{default:(0,r.k6)((e=>[(0,r.bF)(V,{type:h(e.row.status)},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(v(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,r.bF)(I,{label:"操作",width:"160"},{default:(0,r.k6)((e=>[(0,r.bF)(C,{type:"primary",link:"",onClick:t=>F(e.row)},{default:(0,r.k6)((()=>n[9]||(n[9]=[(0,r.eW)("详情")]))),_:2},1032,["onClick"]),e.row.status<4?((0,r.uX)(),(0,r.Wv)(C,{key:0,type:"success",link:"",onClick:t=>y(e.row)},{default:(0,r.k6)((()=>n[10]||(n[10]=[(0,r.eW)("修改状态")]))),_:2},1032,["onClick"])):(0,r.Q3)("",!0),(0,r.bF)(C,{type:"info",link:"",onClick:t=>N(e.row)},{default:(0,r.k6)((()=>n[11]||(n[11]=[(0,r.eW)("查看反馈")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[T,m.value]]),g.value>0?((0,r.uX)(),(0,r.Wv)(W,{key:0,"current-page":t.pageNum,"onUpdate:currentPage":n[4]||(n[4]=e=>t.pageNum=e),"page-size":t.pageSize,"onUpdate:pageSize":n[5]||(n[5]=e=>t.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:g.value,onSizeChange:_,onCurrentChange:w},null,8,["current-page","page-size","total"])):(0,r.Q3)("",!0)])),_:1})])}}};var g=a(1241);const b=(0,g.A)(m,[["__scopeId","data-v-2e7b931c"]]),k=b}}]);
//# sourceMappingURL=829.66c4fed7.js.map