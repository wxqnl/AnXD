"use strict";(self["webpackChunkdaijia_admin"]=self["webpackChunkdaijia_admin"]||[]).push([[768],{1768:(e,a,o)=>{o.r(a),o.d(a,{default:()=>h});var t=o(6768),l=o(4232),n=o(144),u=o(1219),i=o(2933),r=o(5720);function p(e){return(0,r.A)({url:"/coupon/getCouponInfo",method:"post",params:e})}function d(e){return(0,r.A)({url:"/coupon/getCouponInfoByName",method:"get",params:{name:e}})}function s(e){return(0,r.A)({url:"/coupon/addCouponInfo",method:"post",headers:{"Content-Type":"application/json"},data:e})}function c(e){return(0,r.A)({url:"/coupon/updateCouponInfo",method:"post",headers:{"Content-Type":"application/json"},data:e})}function m(e){return(0,r.A)({url:"/coupon/removeCouponInfo",method:"get",params:{id:e}})}const b={class:"app-container"},g={class:"card-header"},k={class:"dialog-footer"},f={__name:"Coupon",setup(e){const a=(0,n.Kh)({pageNum:1,pageSize:10,name:"",couponType:void 0,status:void 0}),o=(0,n.KR)([]),r=(0,n.KR)(!1),f=(0,n.KR)(0),y=(0,n.KR)(!1),F=(0,n.KR)(""),h=(0,n.KR)(null),v=(0,n.Kh)({id:void 0,name:"",couponType:1,amount:void 0,discount:void 0,conditionAmount:0,publishCount:100,perLimit:1,useCount:0,receiveCount:0,expireTime:"",description:"",status:0}),_={name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],couponType:[{required:!0,message:"请选择券类型",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"}],discount:[{required:!0,message:"请输入折扣",trigger:"blur"}],conditionAmount:[{required:!0,message:"请输入使用门槛",trigger:"blur"}],publishCount:[{required:!0,message:"请输入发行数量",trigger:"blur"}],perLimit:[{required:!0,message:"请输入每人限领张数",trigger:"blur"}],expireTime:[{required:!0,message:"请选择过期时间",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},T=async()=>{try{r.value=!0;const e=await p(a);console.log("优惠券列表响应:",e),o.value=e.data.items||[],f.value=e.data.total||0}catch(e){console.error("获取优惠券列表失败",e)}finally{r.value=!1}},C=()=>{a.pageNum=1,T()},V=()=>{a.name="",a.couponType=void 0,a.status=void 0,a.pageNum=1,T()},w=e=>{const a={1:"现金券",2:"折扣券"};return a[e]||"未知"},x=e=>1===e.couponType?`￥${e.amount}`:2===e.couponType?`${e.discount}折`:"",W=e=>e.conditionAmount>0?`满${e.conditionAmount}元可用`:"无门槛",A=e=>{const a={0:"未发布",1:"已发布","-1":"已过期"};return a[e]||"未知"},L=e=>{const a={0:"info",1:"success","-1":"danger"};return a[e]||""},U=()=>{v.id=void 0,v.name="",v.couponType=1,v.amount=void 0,v.discount=void 0,v.conditionAmount=0,v.publishCount=100,v.perLimit=1,v.useCount=0,v.receiveCount=0,v.expireTime="",v.description="",v.status=0,(0,t.dY)((()=>{h.value?.resetFields()}))},N=()=>{U(),F.value="新增优惠券",y.value=!0},S=async e=>{U(),F.value="编辑优惠券",y.value=!0;try{const a=await d(e.name);a.data&&Object.assign(v,a.data)}catch(a){console.error("获取优惠券信息失败",a),u.nk.error("获取优惠券信息失败")}},q=e=>{const a=1===e.status?"停用":"发布",o=1===e.status?0:1;i.s.confirm(`确定要${a}优惠券 ${e.name} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const t=await d(e.name);if(!t.data)throw new Error("获取优惠券信息失败");const l=t.data;l.status=o,await c(l),u.nk.success(`${a}成功`),T()}catch(t){console.error("更新状态失败",t),u.nk.error(`${a}失败: ${t.message||"未知错误"}`)}})).catch((()=>{}))},z=e=>{i.s.confirm(`确定要删除优惠券 ${e.name} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await m(e.id),u.nk.success("删除成功"),T()}catch(a){console.error("删除失败",a),u.nk.error("删除失败")}})).catch((()=>{}))},I=()=>{y.value=!1,U()},$=async()=>{h.value.validate((async e=>{if(e)try{if(v.id){const e=await d(v.name);if(!e.data)throw new Error("获取优惠券信息失败");const a=e.data;a.name=v.name,a.couponType=v.couponType,a.conditionAmount=v.conditionAmount||0,a.publishCount=v.publishCount,a.perLimit=v.perLimit,a.description=v.description||"",a.status=v.status,1===v.couponType?(a.amount=v.amount,a.discount=null):2===v.couponType&&(a.discount=v.discount,a.amount=0),v.expireTime&&(v.expireTime instanceof Date?a.expireTime=v.expireTime.toISOString().slice(0,19):a.expireTime=new Date(v.expireTime).toISOString().slice(0,19)),await c(a),u.nk.success("修改优惠券成功")}else{const e={};e.name=v.name,e.couponType=Number(v.couponType),e.conditionAmount=Number(v.conditionAmount||0),e.publishCount=Number(v.publishCount),e.perLimit=Number(v.perLimit),e.description=v.description||"",e.status=Number(v.status),e.useCount=0,e.receiveCount=0,1===v.couponType?(e.amount=Number(v.amount),e.discount=null):2===v.couponType&&(e.discount=Number(v.discount),e.amount=0),v.expireTime&&(v.expireTime instanceof Date?e.expireTime=v.expireTime.toISOString().slice(0,19):e.expireTime=new Date(v.expireTime).toISOString().slice(0,19)),await s(e),u.nk.success("新增优惠券成功")}y.value=!1,T()}catch(a){console.error("操作失败",a),u.nk.error(`操作失败: ${a.message||"未知错误"}`)}}))},K=e=>{a.pageSize=e,T()},R=e=>{a.pageNum=e,T()};return(0,t.sV)((()=>{T()})),(e,n)=>{const u=(0,t.g2)("el-input"),i=(0,t.g2)("el-form-item"),p=(0,t.g2)("el-option"),d=(0,t.g2)("el-select"),s=(0,t.g2)("el-button"),c=(0,t.g2)("el-form"),m=(0,t.g2)("el-card"),T=(0,t.g2)("el-table-column"),U=(0,t.g2)("el-tag"),j=(0,t.g2)("el-table"),D=(0,t.g2)("el-pagination"),X=(0,t.g2)("el-radio"),B=(0,t.g2)("el-radio-group"),O=(0,t.g2)("el-input-number"),Y=(0,t.g2)("el-date-picker"),Q=(0,t.g2)("el-dialog"),E=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",b,[(0,t.bF)(m,{class:"search-card"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{model:a,ref:"queryForm",inline:!0,class:"search-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"优惠券名称",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:a.name,"onUpdate:modelValue":n[0]||(n[0]=e=>a.name=e),placeholder:"请输入优惠券名称",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"券类型",prop:"couponType"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:a.couponType,"onUpdate:modelValue":n[1]||(n[1]=e=>a.couponType=e),placeholder:"请选择券类型",clearable:""},{default:(0,t.k6)((()=>[(0,t.bF)(p,{label:"现金券",value:1}),(0,t.bF)(p,{label:"折扣券",value:2})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"状态",prop:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:a.status,"onUpdate:modelValue":n[2]||(n[2]=e=>a.status=e),placeholder:"请选择状态",clearable:""},{default:(0,t.k6)((()=>[(0,t.bF)(p,{label:"未发布",value:0}),(0,t.bF)(p,{label:"已发布",value:1}),(0,t.bF)(p,{label:"已过期",value:-1})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(i,null,{default:(0,t.k6)((()=>[(0,t.bF)(s,{type:"primary",onClick:C},{default:(0,t.k6)((()=>n[16]||(n[16]=[(0,t.eW)("查询")]))),_:1}),(0,t.bF)(s,{onClick:V},{default:(0,t.k6)((()=>n[17]||(n[17]=[(0,t.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,t.bF)(m,null,{header:(0,t.k6)((()=>[(0,t.Lk)("div",g,[n[19]||(n[19]=(0,t.Lk)("span",null,"优惠券列表",-1)),(0,t.bF)(s,{type:"primary",onClick:N},{default:(0,t.k6)((()=>n[18]||(n[18]=[(0,t.eW)("新增优惠券")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(j,{data:o.value,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(T,{type:"index",label:"#",width:"50"}),(0,t.bF)(T,{prop:"name",label:"优惠券名称"}),(0,t.bF)(T,{prop:"couponType",label:"券类型"},{default:(0,t.k6)((e=>[(0,t.eW)((0,l.v_)(w(e.row.couponType)),1)])),_:1}),(0,t.bF)(T,{label:"金额/折扣"},{default:(0,t.k6)((e=>[(0,t.eW)((0,l.v_)(x(e.row)),1)])),_:1}),(0,t.bF)(T,{prop:"conditionAmount",label:"使用门槛"},{default:(0,t.k6)((e=>[(0,t.eW)((0,l.v_)(W(e.row)),1)])),_:1}),(0,t.bF)(T,{prop:"expireTime",label:"过期时间"}),(0,t.bF)(T,{prop:"publishCount",label:"发行数量",width:"90"}),(0,t.bF)(T,{prop:"useCount",label:"已使用",width:"80"}),(0,t.bF)(T,{prop:"receiveCount",label:"已领取",width:"80"}),(0,t.bF)(T,{prop:"status",label:"状态"},{default:(0,t.k6)((e=>[(0,t.bF)(U,{type:L(e.row.status)},{default:(0,t.k6)((()=>[(0,t.eW)((0,l.v_)(A(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(T,{label:"操作",width:"180"},{default:(0,t.k6)((e=>[(0,t.bF)(s,{type:"primary",link:"",onClick:a=>S(e.row)},{default:(0,t.k6)((()=>n[20]||(n[20]=[(0,t.eW)("编辑")]))),_:2},1032,["onClick"]),-1!==e.row.status?((0,t.uX)(),(0,t.Wv)(s,{key:0,type:1===e.row.status?"warning":"success",link:"",onClick:a=>q(e.row)},{default:(0,t.k6)((()=>[(0,t.eW)((0,l.v_)(1===e.row.status?"停用":"发布"),1)])),_:2},1032,["type","onClick"])):(0,t.Q3)("",!0),(0,t.bF)(s,{type:"danger",link:"",onClick:a=>z(e.row)},{default:(0,t.k6)((()=>n[21]||(n[21]=[(0,t.eW)("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[E,r.value]]),f.value>0?((0,t.uX)(),(0,t.Wv)(D,{key:0,"current-page":a.pageNum,"onUpdate:currentPage":n[3]||(n[3]=e=>a.pageNum=e),"page-size":a.pageSize,"onUpdate:pageSize":n[4]||(n[4]=e=>a.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:f.value,onSizeChange:K,onCurrentChange:R},null,8,["current-page","page-size","total"])):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(Q,{title:F.value,modelValue:y.value,"onUpdate:modelValue":n[15]||(n[15]=e=>y.value=e),width:"550px","append-to-body":"","close-on-click-modal":!1},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",k,[(0,t.bF)(s,{onClick:I},{default:(0,t.k6)((()=>n[30]||(n[30]=[(0,t.eW)("取 消")]))),_:1}),(0,t.bF)(s,{type:"primary",onClick:$},{default:(0,t.k6)((()=>n[31]||(n[31]=[(0,t.eW)("确 定")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)(c,{ref_key:"couponFormRef",ref:h,model:v,rules:_,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"优惠券名称",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:v.name,"onUpdate:modelValue":n[5]||(n[5]=e=>v.name=e),placeholder:"请输入优惠券名称"},null,8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"券类型",prop:"couponType"},{default:(0,t.k6)((()=>[(0,t.bF)(B,{modelValue:v.couponType,"onUpdate:modelValue":n[6]||(n[6]=e=>v.couponType=e)},{default:(0,t.k6)((()=>[(0,t.bF)(X,{label:1},{default:(0,t.k6)((()=>n[22]||(n[22]=[(0,t.eW)("现金券")]))),_:1}),(0,t.bF)(X,{label:2},{default:(0,t.k6)((()=>n[23]||(n[23]=[(0,t.eW)("折扣券")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),1===v.couponType?((0,t.uX)(),(0,t.Wv)(i,{key:0,label:"金额",prop:"amount"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:v.amount,"onUpdate:modelValue":n[7]||(n[7]=e=>v.amount=e),precision:2,step:.01,min:0,placeholder:"请输入金额"},null,8,["modelValue"]),n[24]||(n[24]=(0,t.Lk)("span",{class:"unit"},"元",-1))])),_:1})):(0,t.Q3)("",!0),2===v.couponType?((0,t.uX)(),(0,t.Wv)(i,{key:1,label:"折扣",prop:"discount"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:v.discount,"onUpdate:modelValue":n[8]||(n[8]=e=>v.discount=e),precision:1,step:.1,min:.1,max:10,placeholder:"请输入折扣"},null,8,["modelValue"]),n[25]||(n[25]=(0,t.Lk)("span",{class:"unit"},"折",-1))])),_:1})):(0,t.Q3)("",!0),(0,t.bF)(i,{label:"使用门槛",prop:"conditionAmount"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:v.conditionAmount,"onUpdate:modelValue":n[9]||(n[9]=e=>v.conditionAmount=e),precision:2,step:.01,min:0,placeholder:"请输入使用门槛"},null,8,["modelValue"]),n[26]||(n[26]=(0,t.Lk)("span",{class:"unit"},"元 (0表示无门槛)",-1))])),_:1}),(0,t.bF)(i,{label:"发行数量",prop:"publishCount"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:v.publishCount,"onUpdate:modelValue":n[10]||(n[10]=e=>v.publishCount=e),min:1,placeholder:"请输入发行数量"},null,8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"每人限领",prop:"perLimit"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{modelValue:v.perLimit,"onUpdate:modelValue":n[11]||(n[11]=e=>v.perLimit=e),min:1,placeholder:"请输入每人限领张数"},null,8,["modelValue"]),n[27]||(n[27]=(0,t.Lk)("span",{class:"unit"},"张",-1))])),_:1}),(0,t.bF)(i,{label:"过期时间",prop:"expireTime"},{default:(0,t.k6)((()=>[(0,t.bF)(Y,{modelValue:v.expireTime,"onUpdate:modelValue":n[12]||(n[12]=e=>v.expireTime=e),type:"datetime",placeholder:"请选择过期时间",format:"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"状态",prop:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(B,{modelValue:v.status,"onUpdate:modelValue":n[13]||(n[13]=e=>v.status=e)},{default:(0,t.k6)((()=>[(0,t.bF)(X,{label:0},{default:(0,t.k6)((()=>n[28]||(n[28]=[(0,t.eW)("未发布")]))),_:1}),(0,t.bF)(X,{label:1},{default:(0,t.k6)((()=>n[29]||(n[29]=[(0,t.eW)("已发布")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"描述",prop:"description"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:v.description,"onUpdate:modelValue":n[14]||(n[14]=e=>v.description=e),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}};var y=o(1241);const F=(0,y.A)(f,[["__scopeId","data-v-011a06c3"]]),h=F}}]);
//# sourceMappingURL=768.c95985cf.js.map