"use strict";(self["webpackChunkdaijia_admin"]=self["webpackChunkdaijia_admin"]||[]).push([[269],{5269:(e,a,l)=>{l.r(a),l.d(a,{default:()=>y});var t=l(6768),o=l(4232),u=l(144),n=l(1219),d=l(2933),r=l(5720);function s(e){return(0,r.A)({url:"/customer/getAllCustomerInfo",method:"post",params:e})}function i(e){return(0,r.A)({url:"/customer/getCustomerInfo",method:"post",params:{username:e}})}function c(e){return(0,r.A)({url:"/customer/remove",method:"post",params:{username:e}})}function p(e){return(0,r.A)({url:"/customer/update",method:"post",params:e})}function b(e){return(0,r.A)({url:"/customer/getCustomerLoginLog",method:"post",params:{username:e},data:{username:e}})}const m={class:"app-container"},k={class:"dialog-footer"},v={class:"avatar-container"},f={key:0},g={key:1,class:"empty-data"},F={__name:"CustomerInfo",setup(e){const a=(0,u.Kh)({pageNum:1,pageSize:10,nickname:"",gender:void 0,phone:"",status:void 0}),l=(0,u.KR)([]),r=(0,u.KR)(!1),F=(0,u.KR)(0),_=(0,u.KR)(!1),h=(0,u.KR)(null),y=(0,u.Kh)({id:"",wxOpenId:"",nickname:"",gender:"",avatarUrl:"",phone:"",status:1}),w=(0,u.KR)(!1),V=(0,u.Kh)({}),W=(0,u.KR)(!1),C=(0,u.KR)(null),U={status:[{required:!0,message:"请选择状态",trigger:"change"}]},I=async()=>{try{r.value=!0;const e=await s(a);console.log("客户列表响应:",e),l.value=e.data.items||[],F.value=e.data.total||0}catch(e){console.error("获取客户列表失败",e)}finally{r.value=!1}},x=()=>{a.pageNum=1,I()},z=()=>{a.nickname="",a.gender=void 0,a.phone="",a.status=void 0,a.pageNum=1,I()},K=()=>{y.id="",y.wxOpenId="",y.nickname="",y.gender="",y.avatarUrl="",y.phone="",y.status=1,(0,t.dY)((()=>{h.value?.resetFields()}))},O=async e=>{K(),_.value=!0;try{const a=await i(e.nickname);a.data&&Object.assign(y,a.data)}catch(a){console.error("获取客户信息失败",a),n.nk.error("获取客户信息失败")}},R=async e=>{try{w.value=!0;const a=await i(e.nickname);a.data&&Object.assign(V,a.data)}catch(a){console.error("获取客户详情失败",a),n.nk.error("获取客户详情失败")}},X=async e=>{try{W.value=!0,C.value=null;const a=await b(e.nickname);console.log("登录日志响应:",a),a.data&&(C.value=a.data)}catch(a){console.error("获取登录日志失败",a),n.nk.error("获取登录日志失败")}},A=e=>{d.s.confirm(`确定要删除客户 ${e.nickname} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await c(e.nickname),n.nk.success("删除成功"),I()}catch(a){console.error("删除客户失败",a),n.nk.error("删除失败")}})).catch((()=>{}))},N=()=>{_.value=!1,K()},D=async()=>{h.value.validate((async e=>{if(e)try{await p(y);n.nk.success("修改客户信息成功"),_.value=!1,I()}catch(a){console.error("操作失败",a),n.nk.error("操作失败，请稍后重试")}}))},L=e=>{a.pageSize=e,I()},S=e=>{a.pageNum=e,I()};return(0,t.sV)((()=>{I()})),(e,u)=>{const n=(0,t.g2)("el-input"),d=(0,t.g2)("el-form-item"),s=(0,t.g2)("el-option"),i=(0,t.g2)("el-select"),c=(0,t.g2)("el-button"),p=(0,t.g2)("el-form"),b=(0,t.g2)("el-card"),I=(0,t.g2)("el-table-column"),K=(0,t.g2)("el-avatar"),j=(0,t.g2)("el-tag"),E=(0,t.g2)("el-table"),q=(0,t.g2)("el-pagination"),B=(0,t.g2)("el-radio"),P=(0,t.g2)("el-radio-group"),Q=(0,t.g2)("el-dialog"),T=(0,t.g2)("el-descriptions-item"),Y=(0,t.g2)("el-descriptions"),$=(0,t.g2)("el-divider"),G=(0,t.g2)("el-image"),H=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",m,[(0,t.bF)(b,{class:"search-card"},{default:(0,t.k6)((()=>[(0,t.bF)(p,{model:a,ref:"queryForm",inline:!0,class:"search-form"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{label:"昵称",prop:"nickname"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:a.nickname,"onUpdate:modelValue":u[0]||(u[0]=e=>a.nickname=e),placeholder:"请输入昵称",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(d,{label:"性别",prop:"gender"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:a.gender,"onUpdate:modelValue":u[1]||(u[1]=e=>a.gender=e),placeholder:"请选择性别",clearable:""},{default:(0,t.k6)((()=>[(0,t.bF)(s,{label:"男",value:"男"}),(0,t.bF)(s,{label:"女",value:"女"})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(d,{label:"手机号",prop:"phone"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:a.phone,"onUpdate:modelValue":u[2]||(u[2]=e=>a.phone=e),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(d,{label:"状态",prop:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:a.status,"onUpdate:modelValue":u[3]||(u[3]=e=>a.status=e),placeholder:"请选择状态",clearable:""},{default:(0,t.k6)((()=>[(0,t.bF)(s,{label:"正常",value:1}),(0,t.bF)(s,{label:"停用",value:2})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(d,null,{default:(0,t.k6)((()=>[(0,t.bF)(c,{type:"primary",onClick:x},{default:(0,t.k6)((()=>u[14]||(u[14]=[(0,t.eW)("查询")]))),_:1}),(0,t.bF)(c,{onClick:z},{default:(0,t.k6)((()=>u[15]||(u[15]=[(0,t.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,t.bF)(b,null,{header:(0,t.k6)((()=>u[16]||(u[16]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"客户列表")],-1)]))),default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(E,{data:l.value,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(I,{type:"index",label:"#",width:"50"}),(0,t.bF)(I,{prop:"nickname",label:"昵称",width:"120"}),(0,t.bF)(I,{prop:"gender",label:"性别",width:"80"}),(0,t.bF)(I,{prop:"phone",label:"手机号",width:"120"}),(0,t.bF)(I,{prop:"wxOpenId",label:"微信OpenID",width:"200","show-overflow-tooltip":""}),(0,t.bF)(I,{label:"头像",width:"80"},{default:(0,t.k6)((e=>[e.row.avatarUrl?((0,t.uX)(),(0,t.Wv)(K,{key:0,src:e.row.avatarUrl,size:40},null,8,["src"])):((0,t.uX)(),(0,t.Wv)(K,{key:1,size:40,icon:"el-icon-user"}))])),_:1}),(0,t.bF)(I,{prop:"status",label:"状态",width:"80"},{default:(0,t.k6)((e=>[(0,t.bF)(j,{type:1===e.row.status?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(1===e.row.status?"正常":"禁用"),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(I,{label:"操作",width:"280"},{default:(0,t.k6)((e=>[(0,t.bF)(c,{type:"primary",link:"",onClick:a=>O(e.row)},{default:(0,t.k6)((()=>u[17]||(u[17]=[(0,t.eW)("编辑")]))),_:2},1032,["onClick"]),(0,t.bF)(c,{type:"danger",link:"",onClick:a=>A(e.row)},{default:(0,t.k6)((()=>u[18]||(u[18]=[(0,t.eW)("删除")]))),_:2},1032,["onClick"]),(0,t.bF)(c,{type:"info",link:"",onClick:a=>X(e.row)},{default:(0,t.k6)((()=>u[19]||(u[19]=[(0,t.eW)("查看日志")]))),_:2},1032,["onClick"]),(0,t.bF)(c,{type:"warning",link:"",onClick:a=>R(e.row)},{default:(0,t.k6)((()=>u[20]||(u[20]=[(0,t.eW)("查看详情")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[H,r.value]]),F.value>0?((0,t.uX)(),(0,t.Wv)(q,{key:0,"current-page":a.pageNum,"onUpdate:currentPage":u[4]||(u[4]=e=>a.pageNum=e),"page-size":a.pageSize,"onUpdate:pageSize":u[5]||(u[5]=e=>a.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:F.value,onSizeChange:L,onCurrentChange:S},null,8,["current-page","page-size","total"])):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(Q,{title:"编辑客户",modelValue:_.value,"onUpdate:modelValue":u[11]||(u[11]=e=>_.value=e),width:"500px","append-to-body":"","close-on-click-modal":!1},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",k,[(0,t.bF)(c,{onClick:N},{default:(0,t.k6)((()=>u[23]||(u[23]=[(0,t.eW)("取消")]))),_:1}),(0,t.bF)(c,{type:"primary",onClick:D},{default:(0,t.k6)((()=>u[24]||(u[24]=[(0,t.eW)("确定")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)(p,{ref_key:"customerFormRef",ref:h,model:y,rules:U,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{label:"客户ID",prop:"id"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:y.id,"onUpdate:modelValue":u[6]||(u[6]=e=>y.id=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(d,{label:"微信OpenID",prop:"wxOpenId"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:y.wxOpenId,"onUpdate:modelValue":u[7]||(u[7]=e=>y.wxOpenId=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(d,{label:"昵称",prop:"nickname"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:y.nickname,"onUpdate:modelValue":u[8]||(u[8]=e=>y.nickname=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(d,{label:"手机号码",prop:"phone"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:y.phone,"onUpdate:modelValue":u[9]||(u[9]=e=>y.phone=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(d,{label:"状态",prop:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(P,{modelValue:y.status,"onUpdate:modelValue":u[10]||(u[10]=e=>y.status=e)},{default:(0,t.k6)((()=>[(0,t.bF)(B,{value:1},{default:(0,t.k6)((()=>u[21]||(u[21]=[(0,t.eW)("正常")]))),_:1}),(0,t.bF)(B,{value:2},{default:(0,t.k6)((()=>u[22]||(u[22]=[(0,t.eW)("禁用")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,t.bF)(Q,{title:"客户详情",modelValue:w.value,"onUpdate:modelValue":u[12]||(u[12]=e=>w.value=e),width:"600px"},{default:(0,t.k6)((()=>[(0,t.bF)(Y,{title:"基本信息",column:2,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(T,{label:"客户ID"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(V.id),1)])),_:1}),(0,t.bF)(T,{label:"微信OpenID"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(V.wxOpenId),1)])),_:1}),(0,t.bF)(T,{label:"昵称"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(V.nickname),1)])),_:1}),(0,t.bF)(T,{label:"性别"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(V.gender),1)])),_:1}),(0,t.bF)(T,{label:"手机号"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(V.phone),1)])),_:1}),(0,t.bF)(T,{label:"状态"},{default:(0,t.k6)((()=>[(0,t.bF)(j,{type:1===V.status?"success":"danger"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(1===V.status?"正常":"禁用"),1)])),_:1},8,["type"])])),_:1})])),_:1}),V.avatarUrl?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bF)($,{"content-position":"center"},{default:(0,t.k6)((()=>u[25]||(u[25]=[(0,t.eW)("头像")]))),_:1}),(0,t.Lk)("div",v,[(0,t.bF)(G,{src:V.avatarUrl,"preview-src-list":[V.avatarUrl],fit:"contain",style:{width:"120px",height:"120px"}},null,8,["src","preview-src-list"])])],64)):(0,t.Q3)("",!0)])),_:1},8,["modelValue"]),(0,t.bF)(Q,{title:"客户登录日志",modelValue:W.value,"onUpdate:modelValue":u[13]||(u[13]=e=>W.value=e),width:"600px"},{default:(0,t.k6)((()=>[C.value?((0,t.uX)(),(0,t.CE)("div",f,[(0,t.bF)(Y,{column:2,border:""},{default:(0,t.k6)((()=>[(0,t.bF)(T,{label:"客户ID"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(C.value.customerId),1)])),_:1}),(0,t.bF)(T,{label:"IP地址"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(C.value.ipaddr||"未记录"),1)])),_:1}),(0,t.bF)(T,{label:"登录状态"},{default:(0,t.k6)((()=>[(0,t.bF)(j,{type:C.value.status?"danger":"success"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(C.value.status?"失败":"成功"),1)])),_:1},8,["type"])])),_:1}),(0,t.bF)(T,{label:"提示信息"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(C.value.msg||"无"),1)])),_:1})])),_:1})])):((0,t.uX)(),(0,t.CE)("div",g," 暂无登录日志数据 "))])),_:1},8,["modelValue"])])}}};var _=l(1241);const h=(0,_.A)(F,[["__scopeId","data-v-72ba088d"]]),y=h}}]);
//# sourceMappingURL=269.c70bf986.js.map